<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DRM Exam &amp; Certificate</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;family=Cinzel:wght@600&amp;family=Montserrat:wght@400;500;600&amp;display=swap" rel="stylesheet" />

  <style>
    :root{
      font-family:"Inter",Arial,sans-serif;
      --clr-bg:#f6f8fa;--clr-card:#fff;--clr-accent:#0b60b6;
      --radius:1rem;--shadow:0 4px 16px rgba(0,0,0,.1)
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--clr-bg);min-height:100vh;display:grid;place-content:start;padding:2rem;overflow:hidden}
    .exam-card{background:var(--clr-card);border-radius:var(--radius);padding:2rem;width:min(100%,48rem);box-shadow:var(--shadow);display:flex;flex-direction:column;gap:1.5rem;margin-inline:auto}
    .question{font-size:1rem;font-weight:600}
    label{display:flex;gap:.5rem;align-items:center;margin:.25rem 0}
    .btn{background:var(--clr-accent);border:none;color:#fff;padding:.75rem 1.5rem;font-size:1rem;border-radius:var(--radius);cursor:pointer;align-self:start;transition:background .25s}
    .btn:hover{background:#094c93}
    .result{font-size:1.25rem;font-weight:600}

    #certificateWrapper{display:none;justify-content:center;margin-top:3rem;flex-direction:column;align-items:center;gap:1.5rem}
    .certificate{background:#fff;border:2px solid #111;box-shadow:0 8px 30px rgba(0,0,0,.12);border-radius:10px;padding:40px;max-width:900px;text-align:center;position:relative;background-image:radial-gradient(circle at 50% 50%,rgba(240,240,240,.6),transparent 90%)}
    .logo{margin-bottom:20px}
    .title{font-family:'Cinzel',serif;font-size:28px;font-weight:600;background:linear-gradient(to right,#b18c2e,#d4af37);-webkit-background-clip:text;color:transparent;letter-spacing:1.2px;margin-bottom:30px}
    .name{font-family:'Cinzel',serif;font-size:24px;font-weight:600;margin:20px 0;letter-spacing:1px;border-bottom:2px solid #bfa97a;display:inline-block;padding:5px 40px}
    .highlight{font-family:'Cinzel',serif;font-size:26px;font-weight:700;letter-spacing:1.5px;background:linear-gradient(to right,#990000,#cc0000);-webkit-background-clip:text;color:transparent;margin:20px 0}
    .date{margin-top:20px;font-size:16px}
    .signatures{display:flex;justify-content:space-around;margin-top:50px;font-size:14px}
    .signature{text-align:center}
    .seal-container{display:flex;justify-content:center;align-items:center;margin-top:50px;gap:50px}
    .certificate-number{font-size:15px;font-family:'Montserrat',sans-serif;text-align:left;font-weight:500;border-left:2px solid #ccc;padding-left:20px}
    p{font-size:16px;margin:10px 0;line-height:1.6;color:#333}
    img{border-radius:4px}.seal img{filter:drop-shadow(0 2px 4px rgba(0,0,0,.1))}.signature img{margin-bottom:5px}
    #downloadBtn{align-self:center;margin-top:1.5rem}

    /* Hide cursor & suppress browser UI hints while exam is running */
    .exam-mode{cursor:none!important}
    /* Override to restore cursor inside the actual exam area only */
    .exam-mode .exam-card, .exam-mode .exam-card *{cursor:auto!important}

    @media print{
      body *{visibility:hidden}
      #certificateWrapper,#certificateWrapper *{visibility:visible}
      #downloadBtn,.result{display:none!important}
      #certificate{position:absolute;top:0;left:0;width:100%}
    }

    /* ---------- GLOBAL ---------- */
body{
  margin:0;
  background:var(--clr-bg);
  min-height:100vh;
  display:grid;
  place-content:start;
  padding:2rem;
  overflow-y:auto;          /* CHANGED ⬅ (was overflow:hidden) */
}

/* ---------- CERTIFICATE WRAPPER ---------- */
#certificateWrapper{
  /* existing properties … */
  display:none;             /* shown later via JS          */
  width:100%;
  min-height:100vh;         /* keeps it full-height        */
  padding:2rem;
  box-sizing:border-box;

  /* NEW: nice centring */
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:1.5rem;
}

/* ---------- CERTIFICATE CARD ---------- */
.certificate{
  /* existing properties … */
  max-width:900px;
  margin:0 auto;            /* NEW: centres horizontally   */
}

  </style>
</head>
<body>
  <!-- EXAM SECTION -->
  <div class="exam-card" id="examCard"></div>

  <!-- CERTIFICATE SECTION -->
  <div id="certificateWrapper">
    <div class="certificate" id="certificate">
      <div class="logo"><img id="certLogo" src="image/garp_logo.png" alt="GARP Logo" width="120"></div>
      <div class="title">FORENSIC INSTITUTE OF DATA &amp; TECHNOLOGY CONSULTANTS</div>
      <p>The Board of Trustees certifies that</p>
      <div class="name" id="certName">John&nbsp;Doe</div>
      <p>having demonstrated knowledge and proficiency to the Data Reconciliation Manager (DRM<sup>®</sup>) Committee and the Board of Trustees is granted the designation of</p>
      <div class="highlight">DATA RECONCILIATION MANAGER</div>
      <p>and is in good standing and entitled to all rights and privileges accorded this designation on this day of</p>
      <div class="date" id="certDate">18&nbsp;/&nbsp;06&nbsp;/&nbsp;2025</div>
      <div class="signatures">
        <div class="signature">
          <img src="Signatures/TIM.png" alt="Signature" height="40"><br>
          <strong>SIMAUNDU&nbsp;CHIBBELA</strong><br>Chairman<br>Board of Trustees
        </div>
        <div class="signature">
          <img src="Signatures/SIM.png" alt="Signature" height="40"><br>
          <strong>SIMON&nbsp;JOHN&nbsp;MWANZA</strong><br>Chairman<br>DRM Committee
        </div>
        <div class="signature">
          <img src="Signatures/JON.png" alt="Signature" height="40"><br>
          <strong>JOHN&nbsp;MWANZA</strong><br>President &amp; CEO
        </div>
      </div>
      <div class="seal-container">
        <div class="seal"><img src="image/Certified.png" alt="Certified Seal" width="100"></div>
        <div class="certificate-number" id="certNumber"><strong>Certificate&nbsp;No:</strong><br> DRM-2025-0001</div>
      </div>
    </div>
    <button class="btn" id="downloadBtn">Download Certificate&nbsp;PDF</button>
  </div>

<script>
/* ─────────────── CONFIG ─────────────── */
const PASS_MARK = 70;

/* ─────────────── STATE ─────────────── */
let examStarted   = false;
let examFinished  = false;

/* ─────────────── FULL-SCREEN + KEYBOARD LOCK ─────────────── */
async function deepLock() {
  // Request fullscreen (kept to minimise distractions).
  if (!document.fullscreenElement) {
    await document.documentElement.requestFullscreen().catch(() => {});
  }
  // Disable (most) keyboard shortcuts – Esc included
  if (navigator.keyboard && navigator.keyboard.lock) {
    try { await navigator.keyboard.lock(); } catch {}
  }
  // Cursor is now hidden globally (CSS rule) but we override inside .exam-card.
  document.body.classList.add('exam-mode');
}

/* Re-establish locks if user breaks them (Esc, long-press, etc.) */
function ensureExamSecurity() {
  if (examStarted && !examFinished) {
    if (!document.fullscreenElement) deepLock();
    // We deliberately DO NOT re‑engage pointer‑lock so the cursor stays visible.
  }
}

// React to lock losses
['fullscreenchange'].forEach(evt => {
  document.addEventListener(evt, ensureExamSecurity);
});

/* ─────────────── LEGACY KEY INTERCEPTION (fallback & extra) ─────────────── */
const BLOCKED_KEYS = new Set([
  'Meta', 'OS', 'Control', 'Alt', 'AltGraph', 'Escape', 'F11', 'F12', 'ContextMenu'
]);

function intercept(e) {
  if (BLOCKED_KEYS.has(e.key) || e.ctrlKey || e.metaKey || e.altKey || e.type === 'contextmenu') {
    e.preventDefault(); e.stopImmediatePropagation();
    return false;
  }
}
function armInterceptors() {
  const o = { capture: true, passive: false };
  window.addEventListener('keydown',  intercept, o);
  window.addEventListener('keyup',    intercept, o);
  window.addEventListener('contextmenu', intercept, o);
}
function disarmInterceptors() {
  const o = { capture: true };
  window.removeEventListener('keydown',  intercept, o);
  window.removeEventListener('keyup',    intercept, o);
  window.removeEventListener('contextmenu', intercept, o);
}

/* ─────────────── EXAM LOGIC ─────────────── */
function preload(src) { return new Promise((res, rej) => { const i = new Image(); i.onload = res; i.onerror = rej; i.src = src; }); }

const student = { name: '', email: '' };
(function collect() {
  student.name  = prompt('Enter your full name:')?.trim();
  student.email = prompt('Enter your email address:')?.trim();
  if (!student.name || !student.email) { alert('Name and Email are required.'); location.reload(); }
})();

const questions = [
  { q: 'Which function is used to calculate the average of a range in Excel?', options: ['=MEAN()', '=AVERAGE()', '=SUM()', '=MEDIAN()'], answer: 1 },
  { q: 'What shortcut (Windows) adds a new worksheet?', options: ['Shift + F11', 'Ctrl + N', 'Alt + F2', 'Ctrl + Shift + S'], answer: 0 },
  { q: 'The VLOOKUP function searches for a value in the ____ column?', options: ['First', 'Last', 'Selected', 'Any'], answer: 0 },
];

function renderExam() {
  const examCard = document.getElementById('examCard');
  const form = document.createElement('form');

  questions.forEach((q, i) => {
    const fs = document.createElement('fieldset');
    const lg = document.createElement('legend');
    lg.className = 'question';
    lg.textContent = `${i + 1}. ${q.q}`;
    fs.appendChild(lg);
    q.options.forEach((opt, j) => {
      const lb = document.createElement('label');
      const inp = document.createElement('input');
      inp.type = 'radio'; inp.name = `q${i}`; inp.value = j;
      lb.appendChild(inp); lb.append(opt); fs.appendChild(lb);
    });
    form.appendChild(fs);
  });

  const btn = document.createElement('button');
  btn.type = 'submit'; btn.className = 'btn'; btn.textContent = 'Submit Exam';
  form.appendChild(btn);
  form.addEventListener('submit', gradeExam);
  examCard.appendChild(form);

  // First click starts secure mode
  examCard.addEventListener('click', async () => {
    if (!examStarted) {
      examStarted = true;
      await deepLock();
      armInterceptors();
    }
  }, { once: true });
}

function gradeExam(ev) {
  ev.preventDefault();
  const fd = new FormData(ev.target);
  for (let i = 0; i < questions.length; i++) {
    if (fd.get(`q${i}`) === null) { alert('Please answer all questions.'); return; }
  }
  const score = questions.reduce((s, q, i) => s + (+fd.get(`q${i}`) === q.answer), 0);
  const pct = (score / questions.length) * 100;

  const examCard = document.getElementById('examCard');
  examCard.innerHTML = '';
  const p = document.createElement('p'); p.className = 'result'; p.textContent = `You scored ${pct.toFixed(0)}%.`;
  examCard.appendChild(p);

  examFinished = true;
  disarmInterceptors();
  document.body.classList.remove('exam-mode');
  if (document.fullscreenElement) document.exitFullscreen?.();

  if (pct >= PASS_MARK) {
    examCard.append('\nCongratulations!');
    showCertificate();
  } else {
    examCard.append(`\nUnfortunately you did not reach the ${PASS_MARK}% pass mark.`);
  }
}

/* ─────────────── CERTIFICATE ─────────────── */
function genNumber() {
  const y = new Date().getFullYear(); const k = `certIndex-${y}`;
  const n = (+(localStorage.getItem(k) || 0)) + 1; localStorage.setItem(k, n);
  return `DRM-${y}-${n.toString().padStart(4, '0')}`;
}
function fmtDate(d) { return `${String(d.getDate()).padStart(2, '0')} / ${String(d.getMonth() + 1).padStart(2, '0')} / ${d.getFullYear()}`; }

function fillCertificate() {
  document.getElementById('certName').textContent = student.name.toUpperCase();
  document.getElementById('certDate').textContent = fmtDate(new Date());
  document.getElementById('certNumber').innerHTML = `<strong>Certificate No:</strong><br> ${genNumber()}`;
}
async function showCertificate() {
  fillCertificate();
  const imgs=[...document.querySelectorAll('#certificate img')];
  await Promise.all(imgs.map(i=>preload(i.src)));

  /* RE-ENABLE NORMAL SCROLLING */
  document.body.style.overflow='auto';

  const w=document.getElementById('certificateWrapper');
  w.style.display='flex';

  /* Smoothly bring the certificate into view */
  w.scrollIntoView({behavior:'smooth'});
}
function downloadPDF() {
  const w = document.getElementById('certificateWrapper');
  window.scrollTo({ top: w.offsetTop, behavior: 'smooth' });
  setTimeout(() => window.print(), 500);
}

/* ─────────────── INIT ─────────────── */
window.addEventListener('load', () => {
  renderExam();
  document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
});
</script>
</body>
</html>
